<form id="StudentSelectionForm" action="/settings" method="post">
    {% csrf_token %}
    {{ form }}
    <label for="selectStudent">Select a student...   </label><br/>
    <select id="selectStudent" name="selectStudent" class="filter-selectbox" style="width:300px;" required>
    {% for student in students %}
        <option value="{{ student.studentID }}">
            {{ student.studentFirstName }} {{ student.studentLastName }}
        </option>
    {% endfor %} </select>
</form>
<br/><br/>
<div id="calendarSettings"/>
</div>
<script>

function getCalendar(header, initial, url){
    loadCalendar(header, initial);
    view = url;
    return mainCalendar;
}

var mainCalendar;
var view;

function loadCalendar(header, initial){
  mainCalendar = new FullCalendar.Calendar($('#calendarSettings')[0], {
    headerToolbar: { center:  header},
      titleFormat: {
        month: 'numeric',
        year: '2-digit',
        day: 'numeric',
    },
    initialView: initial,
    timeZone: 'local',
    events: [
         {% for event in events %}
            {
                title: '{{ event.description }}',
                description: '{{ event.details }}',
                start: '{{ event.start|date:"Y-m-d" }}T{{ event.start|time:"H:i"}}',
                end: '{{ event.end|date:"Y-m-d" }}T{{ event.end|time:"H:i"}}',
                allDay: '{{ event.allDay }}',
                {% if event.reoccurType %}
                rrule: {
                    freq: '{{event.reoccurType.recurrenceTypeName}}',
                    until: '{{ event.reoccurEnd|date:"Y-m-d" }}T{{ event.reoccurEnd|time:"H:i" }}'
                }
                {% endif %}
            },
         {% endfor %}
      ],
    dateClick: function(info) {dateClickCustom(info)},
    eventDidMount: function(info) {
        $(info.el).tooltip({
            title: info.event.extendedProps.description ?? " ",
        });
    },
  });
}

var dateClickCustom = function(info)
{}

$('#selectStudent').on('change',function(){
    $.ajax({
        url: view,
        type: 'GET',
        cache: false,
        data:{"studentID" : document.getElementById('selectStudent').value },
        success: function (response) {
            var eventSources = mainCalendar.getEventSources();
            for(var i in eventSources)
            {
                eventSources[i].remove();
            }
            mainCalendar.addEventSource(response.eventSource);
        },
        complete: function () {
            var eventSources = mainCalendar.getEventSources();
                for(var i in eventSources)
                {
                    eventSources[i].refetch();
                }
                mainCalendar.render();
        },
        error: function (response) {
            alert(response["responseJSON"]["error"]);
        }
    })
});
 </script>